# Requirements Archive: v3.6 Windows Compatibility

**Archived:** 2026-02-28
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: DittoFS v3.6 Windows Compatibility

**Defined:** 2026-02-26
**Core Value:** Full Windows SMB compatibility with proper ACL support, bug fixes, and conformance testing

## v3.6 Requirements

### Bug Fixes

- [x] **BUG-01**: Sparse file READ returns zeros for unwritten blocks instead of errors (#180)
- [x] **BUG-02**: Renamed directory children reflect updated paths in QUERY_DIRECTORY (#181)
- [x] **BUG-03**: Multi-component paths with `..` segments navigate to parent directory (#214)
- [x] **BUG-04**: NFS v3 operations trigger oplock break for SMB clients holding locks (#213)
- [x] **BUG-05**: FileStandardInfo.NumberOfLinks reads actual link count from metadata (#221)
- [x] **BUG-06**: Share list cached for pipe CREATE operations, invalidated on change (#223)

### Security Descriptors

- [x] **SD-01**: Default DACL synthesized from POSIX mode bits (owner/group/other) when no ACL exists
- [x] **SD-02**: ACEs ordered in canonical Windows order (deny before allow)
- [x] **SD-03**: Well-known SIDs included in default DACL (NT AUTHORITY\SYSTEM, BUILTIN\Administrators)
- [x] **SD-04**: ACE flag translation corrected (NFSv4 INHERITED_ACE 0x80 -> Windows 0x10)
- [x] **SD-05**: Inheritance flags (CONTAINER_INHERIT, OBJECT_INHERIT) set on directory ACEs
- [x] **SD-06**: SE_DACL_AUTO_INHERITED control flag set when ACEs have INHERITED flag
- [x] **SD-07**: SID user/group collision fixed (different RID ranges for users vs groups)
- [x] **SD-08**: SACL query returns valid empty SACL structure (not omitted)

### Windows 11 Compatibility

- [x] **WIN-01**: CREATE response context wire encoding fixed (lease responses actually sent) *(completed in Phase 29.8)*
- [x] **WIN-02**: MxAc (Maximal Access) create context response returned to clients
- [x] **WIN-03**: QFid (Query on Disk ID) create context response returned to clients
- [x] **WIN-04**: SMB signing validated and enforced for all authenticated sessions *(completed in Phase 29.8)*
- [x] **WIN-05**: Missing FileInfoClass handlers added *(partially completed in Phase 29.8: FilePositionInfo, FileModeInfo, FileAlignmentInfo done; FileCompressionInfo, FileAttributeTagInfo still needed)*
- [x] **WIN-06**: Guest access signing negotiation handled for Windows 11 24H2
- [x] **WIN-07**: FileFsAttributeInformation capability flags reflect supported features (#141)
- [x] **WIN-08**: Windows CI build step added to GitHub Actions (#173)
- [x] **WIN-09**: NFS and SMB client compatibility validated from Windows (#172)
- [x] **WIN-10**: Hardcoded Unix paths fixed for Windows compatibility (#169)

### Conformance Testing

- [x] **TEST-01**: smbtorture SMB2 test suite run against DittoFS, failures triaged
- [x] **TEST-02**: Newly-revealed conformance failures fixed iteratively
- [x] **TEST-03**: KNOWN_FAILURES.md updated with current pass/fail status

## Future Requirements (v3.7+)

### Deferred

- **Short name (8.3) generation** — Low priority, only affects legacy apps
- **FILE_ATTRIBUTE_ARCHIVE flag** — Improves backup tool compat, not critical
- **CHANGE_NOTIFY cleanup on disconnect** — Quality improvement, not blocking
- **FileNormalizedNameInformation** — Helps path normalization, not required
- **Full SACL enforcement** — Requires audit logging infrastructure
- **Domain-aware SID construction** — Stable pseudo-domain SID from ServerGUID (nice-to-have)

## Out of Scope

| Feature | Reason |
|---------|--------|
| SMB 3.0/3.0.2/3.1.1 dialect negotiation | v3.8 milestone |
| AES encryption (SMB3) | v3.8 milestone |
| Durable handles (DHnQ/DH2Q) | v3.8 milestone |
| Multi-channel / RDMA | v3.8 milestone |
| Server-side copy (FSCTL_SRV_COPYCHUNK) | v3.8 or v4.0 |
| Extended Attributes (EA) | v4.0 with NFSv4.2 xattrs |
| POSIX Extensions for SMB | Not needed for Windows compat |
| Raw SD byte caching for round-trip fidelity | Complexity vs benefit tradeoff |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| BUG-01 | Phase 30 | Complete |
| BUG-02 | Phase 30 | Complete |
| BUG-03 | Phase 30 | Complete |
| BUG-04 | Phase 30 | Complete |
| BUG-05 | Phase 30 | Complete |
| BUG-06 | Phase 30 | Complete |
| SD-01 | Phase 31 | Complete |
| SD-02 | Phase 31 | Complete |
| SD-03 | Phase 31 | Complete |
| SD-04 | Phase 31 | Complete |
| SD-05 | Phase 31 | Complete |
| SD-06 | Phase 31 | Complete |
| SD-07 | Phase 31 | Complete |
| SD-08 | Phase 31 | Complete |
| WIN-01 | Phase 29.8 | **Complete** |
| WIN-02 | Phase 32 | Complete |
| WIN-03 | Phase 32 | Complete |
| WIN-04 | Phase 29.8 | **Complete** |
| WIN-05 | Phase 29.8 / 32 | **Partial** (3/5 handlers done) |
| WIN-06 | Phase 32 | Complete |
| WIN-07 | Phase 32 | Complete |
| WIN-08 | Phase 32 | Complete |
| WIN-09 | Phase 32 | Complete |
| WIN-10 | Phase 32 | Complete |
| TEST-01 | Phase 32 | Complete |
| TEST-02 | Phase 32 | Complete |
| TEST-03 | Phase 32 | Complete |

**Coverage:**
- v3.6 requirements: 27 total
- Complete: 2 (WIN-01, WIN-04)
- Partial: 1 (WIN-05)
- Pending: 24
- Unmapped: 0 ✓

---
*Requirements defined: 2026-02-26*
*Last updated: 2026-02-26 after roadmap refinement*
