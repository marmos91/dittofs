# Requirements Archive: v1.0 E2E Test Suite

**Archived:** 2026-02-03
**Status:** SHIPPED

This is the archived requirements specification for v1.0.

---

# Requirements: DittoFS E2E Test Suite Redesign

**Defined:** 2026-02-02
**Core Value:** Validate DittoFS works correctly with new control plane APIs, all store combinations, and both NFS/SMB protocols

## v1 Requirements

Requirements for the new E2E test suite. Each maps to roadmap phases.

### CLI Infrastructure

- [x] **CLI-01**: `dittofsctl share mount` command mounts shares via NFS
- [x] **CLI-02**: `dittofsctl share mount` command mounts shares via SMB
- [x] **CLI-03**: `dittofsctl share unmount` command cleanly unmounts shares
- [x] **CLI-04**: SMB mount defaults to logged-in user credentials
- [x] **CLI-05**: SMB mount accepts `--username`/`--password` override
- [x] **CLI-06**: Mount commands work on macOS
- [x] **CLI-07**: Mount commands work on Linux

### Test Framework

- [x] **FRM-01**: New test framework using Go testing + testify
- [x] **FRM-02**: Testcontainers integration for Postgres
- [x] **FRM-03**: Testcontainers integration for S3 (Localstack)
- [x] **FRM-04**: Container reuse across test runs
- [x] **FRM-05**: Shared server model with per-test cleanup
- [x] **FRM-06**: Test tags for selective execution
- [x] **FRM-07**: Cleanup works even on test failure/interruption
- [x] **FRM-08**: CI/CD compatibility (GitHub Actions)

### Server Lifecycle

- [x] **SRV-01**: Server starts successfully with valid config
- [x] **SRV-02**: Server stops gracefully on SIGTERM
- [x] **SRV-03**: Status command reports correct running state
- [x] **SRV-04**: Graceful shutdown completes in-flight operations
- [x] **SRV-05**: Config validate detects invalid configurations

### Users Management

- [x] **USR-01**: Create admin user via CLI
- [x] **USR-02**: Change user password via CLI
- [x] **USR-03**: Create new users via CLI
- [x] **USR-04**: List users via CLI
- [x] **USR-05**: Edit user info via CLI
- [x] **USR-06**: Delete users via CLI
- [x] **USR-07**: Negative: Cannot delete user with active permissions

### Groups Management

- [x] **GRP-01**: Create groups via CLI
- [x] **GRP-02**: List groups via CLI
- [x] **GRP-03**: Edit group info via CLI
- [x] **GRP-04**: Delete groups via CLI
- [x] **GRP-05**: Add user to group via CLI
- [x] **GRP-06**: Remove user from group via CLI
- [x] **GRP-07**: Negative: Cannot delete group with active permissions

### Protocol Adapters

- [x] **ADP-01**: Enable NFS adapter via CLI
- [x] **ADP-02**: Disable NFS adapter via CLI
- [x] **ADP-03**: Enable SMB adapter via CLI
- [x] **ADP-04**: Disable SMB adapter via CLI
- [x] **ADP-05**: Change adapter port configuration
- [x] **ADP-06**: Hot reload: config change takes effect without restart
- [x] **ADP-07**: Restart: adapter restarts cleanly after stop/start
- [x] **ADP-08**: Negative: Invalid adapter config is rejected

### Metadata Stores

- [x] **MDS-01**: Create memory metadata store via CLI
- [x] **MDS-02**: Create BadgerDB metadata store via CLI
- [x] **MDS-03**: Create PostgreSQL metadata store via CLI
- [x] **MDS-04**: List metadata stores via CLI
- [x] **MDS-05**: Edit metadata store config via CLI
- [x] **MDS-06**: Delete metadata store via CLI
- [x] **MDS-07**: Negative: Cannot delete store used by share

### Payload Stores

- [x] **PLS-01**: Create memory payload store via CLI
- [x] **PLS-02**: Create filesystem payload store via CLI
- [x] **PLS-03**: Create S3 payload store via CLI
- [x] **PLS-04**: List payload stores via CLI
- [x] **PLS-05**: Edit payload store config via CLI
- [x] **PLS-06**: Delete payload store via CLI
- [x] **PLS-07**: Negative: Cannot delete store used by share

### Shares

- [x] **SHR-01**: Create share with assigned stores via CLI
- [x] **SHR-02**: List shares via CLI
- [x] **SHR-03**: Edit share configuration via CLI
- [x] **SHR-04**: Delete share via CLI
- [ ] **SHR-05**: Share deletion flags data as deleted (soft delete) — DEFERRED: Server implements hard delete
- [ ] **SHR-06**: Deferred cleanup of store data after share deletion — DEFERRED: Server implements hard delete

### Permissions

- [x] **PRM-01**: Grant read permission to user via CLI
- [x] **PRM-02**: Grant read-write permission to user via CLI
- [x] **PRM-03**: Grant read permission to group via CLI
- [x] **PRM-04**: Grant read-write permission to group via CLI
- [x] **PRM-05**: Revoke permission from user via CLI
- [x] **PRM-06**: Revoke permission from group via CLI
- [x] **PRM-07**: List permissions for share via CLI

### Backup/Restore

- [x] **BAK-01**: Backup control plane state via CLI
- [x] **BAK-02**: Restore control plane state via CLI
- [x] **BAK-03**: Round-trip: backup -> restore -> verify data intact
- [x] **BAK-04**: Restore fails gracefully on invalid backup file

### Multi-Context

- [x] **CTX-01**: List server contexts via CLI
- [x] **CTX-02**: Add new server context via CLI
- [x] **CTX-03**: Remove server context via CLI
- [x] **CTX-04**: Switch active context via CLI
- [x] **CTX-05**: Context credentials don't leak between switches

### File Operations (NFS)

- [x] **NFS-01**: Read files via NFS mount
- [x] **NFS-02**: Write files via NFS mount
- [x] **NFS-03**: Delete files via NFS mount
- [x] **NFS-04**: List directories via NFS mount
- [x] **NFS-05**: Create directories via NFS mount
- [x] **NFS-06**: Change file permissions via NFS mount

### File Operations (SMB)

- [x] **SMB-01**: Read files via SMB mount
- [x] **SMB-02**: Write files via SMB mount
- [x] **SMB-03**: Delete files via SMB mount
- [x] **SMB-04**: List directories via SMB mount
- [x] **SMB-05**: Create directories via SMB mount
- [x] **SMB-06**: Change file permissions via SMB mount

### Cross-Protocol Interoperability

- [x] **XPR-01**: File created via NFS readable via SMB
- [x] **XPR-02**: File created via SMB readable via NFS
- [x] **XPR-03**: File created via NFS deletable via SMB
- [x] **XPR-04**: File created via SMB deletable via NFS
- [x] **XPR-05**: Directory created via NFS listable via SMB
- [x] **XPR-06**: Directory created via SMB listable via NFS

### Permission Enforcement

- [x] **ENF-01**: Read-only user cannot write files
- [x] **ENF-02**: No-access user cannot read files
- [x] **ENF-03**: User removed from group loses group permissions
- [x] **ENF-04**: Permission change takes effect immediately

### Store Matrix

- [x] **MTX-01**: All operations work with memory/memory stores
- [x] **MTX-02**: All operations work with memory/filesystem stores
- [x] **MTX-03**: All operations work with memory/s3 stores
- [x] **MTX-04**: All operations work with badger/memory stores
- [x] **MTX-05**: All operations work with badger/filesystem stores
- [x] **MTX-06**: All operations work with badger/s3 stores
- [x] **MTX-07**: All operations work with postgres/memory stores
- [x] **MTX-08**: All operations work with postgres/filesystem stores
- [x] **MTX-09**: All operations work with postgres/s3 stores

---

## Milestone Summary

**Shipped:** 82 of 84 v1 requirements

**Deferred:**
- SHR-05 (soft delete) — Server implements hard delete, not soft delete
- SHR-06 (deferred cleanup) — Depends on SHR-05

---
*Archived: 2026-02-03 as part of v1.0 milestone completion*
