---
phase: 28-smb-adapter-restructuring
plan: 05
type: execute
wave: 4
depends_on: [28-02, 28-03, 28-04]
files_modified:
  - internal/adapter/smb/v2/handlers/change_notify.go
  - internal/adapter/smb/v2/handlers/close.go
  - internal/adapter/smb/v2/handlers/create.go
  - internal/adapter/smb/v2/handlers/echo.go
  - internal/adapter/smb/v2/handlers/flush.go
  - internal/adapter/smb/v2/handlers/lock.go
  - internal/adapter/smb/v2/handlers/logoff.go
  - internal/adapter/smb/v2/handlers/negotiate.go
  - internal/adapter/smb/v2/handlers/query_directory.go
  - internal/adapter/smb/v2/handlers/query_info.go
  - internal/adapter/smb/v2/handlers/read.go
  - internal/adapter/smb/v2/handlers/security.go
  - internal/adapter/smb/v2/handlers/session_setup.go
  - internal/adapter/smb/v2/handlers/set_info.go
  - internal/adapter/smb/v2/handlers/tree_connect.go
  - internal/adapter/smb/v2/handlers/tree_disconnect.go
  - internal/adapter/smb/v2/handlers/write.go
  - internal/adapter/smb/v2/handlers/lease.go
  - internal/adapter/smb/v2/handlers/oplock.go
autonomous: true
requirements: [REF-04]

must_haves:
  truths:
    - "Every exported handler function in internal/adapter/smb/v2/handlers/ has a 3-5 line Godoc comment"
    - "Documentation describes what the handler does, the SMB2 command it implements, and key behavior"
    - "No functional code changes - documentation only"
    - "All tests still pass"
  artifacts:
    - path: "internal/adapter/smb/v2/handlers/"
      provides: "All handler files with 3-5 line Godoc comments on exported functions"
  key_links: []
---

<objective>
Add 3-5 line Godoc documentation to all SMB2 handler functions in internal/adapter/smb/v2/handlers/.

Purpose: Consistent with NFS handler documentation style from Phase 27 Plan 04. Ensures all handler functions are self-documenting for future maintainers and SMB3 upgrade work.
Output: Every exported handler function has clear Godoc describing its SMB2 command behavior.
</objective>

<execution_context>
@/Users/marmos91/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marmos91/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-smb-adapter-restructuring/28-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Godoc to core SMB2 handlers</name>
  <files>
    internal/adapter/smb/v2/handlers/negotiate.go
    internal/adapter/smb/v2/handlers/session_setup.go
    internal/adapter/smb/v2/handlers/tree_connect.go
    internal/adapter/smb/v2/handlers/tree_disconnect.go
    internal/adapter/smb/v2/handlers/logoff.go
    internal/adapter/smb/v2/handlers/create.go
    internal/adapter/smb/v2/handlers/close.go
    internal/adapter/smb/v2/handlers/read.go
    internal/adapter/smb/v2/handlers/write.go
    internal/adapter/smb/v2/handlers/flush.go
    internal/adapter/smb/v2/handlers/echo.go
  </files>
  <action>
    Add 3-5 line Godoc comments to each exported handler function in the core SMB2 handler files. The doc style should match the NFS handler documentation pattern:

    ```go
    // HandleNegotiate processes an SMB2 NEGOTIATE request.
    // Negotiates the protocol dialect (2.0.2/2.1/3.0/3.0.2/3.1.1),
    // security mode (signing required/enabled), and capabilities.
    // Returns the negotiate response with server GUID and security buffer.
    ```

    Cover these handler files:
    - negotiate.go: Negotiate handler (dialect negotiation)
    - session_setup.go: Session Setup handler (SPNEGO/NTLM auth)
    - tree_connect.go: Tree Connect handler (share mapping)
    - tree_disconnect.go: Tree Disconnect handler (share unmapping)
    - logoff.go: Logoff handler (session teardown)
    - create.go: Create handler (file/directory open/create, oplock/lease)
    - close.go: Close handler (file handle release, final flush)
    - read.go: Read handler (file content read)
    - write.go: Write handler (file content write)
    - flush.go: Flush handler (commit pending writes)
    - echo.go: Echo handler (keepalive/connectivity check)

    Also document the Handler struct and key exported methods in handler.go if not already documented.

    Documentation only -- NO functional changes.
  </action>
  <verify>
    <automated>cd /Users/marmos91/Projects/dittofs && go build ./internal/adapter/smb/... && go vet ./internal/adapter/smb/...</automated>
  </verify>
  <done>Core SMB2 handlers (negotiate, session, tree, create, close, read, write, flush, echo, logoff) have 3-5 line Godoc comments.</done>
</task>

<task type="auto">
  <name>Task 2: Add Godoc to advanced SMB2 handlers</name>
  <files>
    internal/adapter/smb/v2/handlers/query_info.go
    internal/adapter/smb/v2/handlers/set_info.go
    internal/adapter/smb/v2/handlers/query_directory.go
    internal/adapter/smb/v2/handlers/lock.go
    internal/adapter/smb/v2/handlers/change_notify.go
    internal/adapter/smb/v2/handlers/security.go
    internal/adapter/smb/v2/handlers/lease.go
    internal/adapter/smb/v2/handlers/oplock.go
    internal/adapter/smb/v2/handlers/cross_protocol.go
    internal/adapter/smb/v2/handlers/stub_handlers.go
  </files>
  <action>
    Add 3-5 line Godoc comments to each exported handler function in the advanced SMB2 handler files:

    - query_info.go: Query Info handler (file/filesystem/security attributes)
    - set_info.go: Set Info handler (modify file/security attributes)
    - query_directory.go: Query Directory handler (directory listing with patterns)
    - lock.go: Lock handler (byte-range locking via Unified Lock Manager)
    - change_notify.go: Change Notify handler (directory change watching)
    - security.go: Security handler (NT security descriptor queries)
    - lease.go: Lease handler (opportunistic lock caching)
    - oplock.go: Oplock handler (file caching notifications)
    - cross_protocol.go: Cross-protocol helpers (NFS/SMB coordination)
    - stub_handlers.go: Stub handlers for unimplemented commands

    Also document key helper functions and structs in:
    - converters.go: Type conversion helpers
    - encoding.go: Wire format encoding helpers
    - context.go: SMBHandlerContext
    - requests.go: Request parsing types
    - result.go: HandlerResult type
    - auth_helper.go: Auth helper functions

    Documentation only -- NO functional changes.

    Run full test suite after completion.
  </action>
  <verify>
    <automated>cd /Users/marmos91/Projects/dittofs && go build ./... && go test ./...</automated>
  </verify>
  <done>All SMB2 handler functions documented with 3-5 line Godoc. Full test suite passes. Phase 28 complete.</done>
</task>

</tasks>

<verification>
1. Spot-check: `go doc ./internal/adapter/smb/v2/handlers/ HandleCreate` shows documentation
2. `go build ./...` succeeds
3. `go test ./...` passes with zero failures
4. `go vet ./...` passes
5. No functional changes in any handler file (diff shows only comment additions)
</verification>

<success_criteria>
- Every exported handler function has 3-5 line Godoc comment
- Documentation describes SMB2 command, key behavior, and return semantics
- Consistent style matching NFS handler documentation
- Zero functional changes
- Full test suite green
</success_criteria>

<output>
After completion, create `.planning/phases/28-smb-adapter-restructuring/28-05-SUMMARY.md`
</output>
