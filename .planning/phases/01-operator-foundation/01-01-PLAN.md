---
phase: 01-operator-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - k8s/dittofs-operator/* (entire directory created)
  - dittofs-operator/* (deleted after relocation)
autonomous: true

must_haves:
  truths:
    - "Operator source code exists at k8s/dittofs-operator/"
    - "go build succeeds in new location"
    - "make generate succeeds with updated module path"
    - "make manifests generates CRD and RBAC"
  artifacts:
    - path: "k8s/dittofs-operator/go.mod"
      provides: "Go module definition with updated path"
      contains: "module github.com/marmos91/dittofs/k8s/dittofs-operator"
    - path: "k8s/dittofs-operator/api/v1alpha1/dittoserver_types.go"
      provides: "CRD type definitions"
      contains: "type DittoServer struct"
    - path: "k8s/dittofs-operator/internal/controller/dittoserver_controller.go"
      provides: "Reconciliation logic"
      contains: "func (r *DittoServerReconciler) Reconcile"
    - path: "k8s/dittofs-operator/Makefile"
      provides: "Build automation"
  key_links:
    - from: "k8s/dittofs-operator/internal/controller/dittoserver_controller.go"
      to: "k8s/dittofs-operator/api/v1alpha1"
      via: "import statement"
      pattern: "github.com/marmos91/dittofs/k8s/dittofs-operator/api/v1alpha1"
---

<objective>
Relocate the existing operator scaffold from `dittofs-operator/` to `k8s/dittofs-operator/` per requirement R1.5.

Purpose: Organize Kubernetes-specific code under the k8s/ directory following project conventions. The existing operator is nearly complete - this is a relocation task, not greenfield development.

Output: Fully functional operator codebase in new location with updated Go module path.
</objective>

<execution_context>
@/Users/marmos91/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marmos91/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-operator-foundation/01-RESEARCH.md
@dittofs-operator/go.mod
@dittofs-operator/PROJECT
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy operator to k8s/dittofs-operator/</name>
  <files>k8s/dittofs-operator/*</files>
  <action>
Create the k8s/ directory and copy the entire dittofs-operator/ directory into it:

1. Create k8s/ directory: `mkdir -p k8s`
2. Copy entire operator: `cp -R dittofs-operator k8s/`
3. Verify the copy includes all subdirectories: api/, internal/, config/, cmd/, utils/

Do NOT delete the original dittofs-operator/ yet - we need to verify the new location works first.
  </action>
  <verify>
Run: `ls -la k8s/dittofs-operator/` - should show all directories (api, internal, config, cmd, utils)
Run: `ls k8s/dittofs-operator/api/v1alpha1/` - should show dittoserver_types.go
  </verify>
  <done>All operator files exist in k8s/dittofs-operator/ with correct directory structure</done>
</task>

<task type="auto">
  <name>Task 2: Update Go module path and all imports</name>
  <files>
k8s/dittofs-operator/go.mod
k8s/dittofs-operator/cmd/main.go
k8s/dittofs-operator/internal/controller/dittoserver_controller.go
k8s/dittofs-operator/internal/controller/config/config.go
k8s/dittofs-operator/api/v1alpha1/groupversion_info.go
k8s/dittofs-operator/PROJECT
  </files>
  <action>
Update the Go module path from `github.com/marmos91/dittofs/dittofs-operator` to `github.com/marmos91/dittofs/k8s/dittofs-operator`:

1. Edit k8s/dittofs-operator/go.mod:
   - Change module line to: `module github.com/marmos91/dittofs/k8s/dittofs-operator`

2. Edit k8s/dittofs-operator/PROJECT:
   - Update `repo:` to: `github.com/marmos91/dittofs/k8s/dittofs-operator`
   - Update `projectName:` to: `dittofs/k8s/dittofs-operator`
   - Update `path:` in resources to: `github.com/marmos91/dittofs/k8s/dittofs-operator/api/v1`

3. Update all import statements in Go files. Use sed or manual editing to replace:
   - `github.com/marmos91/dittofs/dittofs-operator/` -> `github.com/marmos91/dittofs/k8s/dittofs-operator/`

Key files to update:
   - cmd/main.go
   - internal/controller/dittoserver_controller.go
   - internal/controller/config/config.go
   - api/v1alpha1/groupversion_info.go
   - Any test files (*_test.go)

4. Run `go mod tidy` in k8s/dittofs-operator/ to verify module resolution
  </action>
  <verify>
Run from k8s/dittofs-operator/:
- `go mod tidy` completes without errors
- `grep -r "dittofs-operator/api" . | grep -v "k8s/dittofs-operator"` returns empty (no old imports)
  </verify>
  <done>All Go imports use new module path, go mod tidy succeeds</done>
</task>

<task type="auto">
  <name>Task 3: Verify build and code generation</name>
  <files>
k8s/dittofs-operator/config/crd/bases/dittofs.dittofs.com_dittoservers.yaml
k8s/dittofs-operator/config/rbac/role.yaml
k8s/dittofs-operator/api/v1alpha1/zz_generated.deepcopy.go
  </files>
  <action>
Verify the operator builds and generates correctly in the new location:

1. Change to k8s/dittofs-operator/ directory

2. Run code generation:
   - `make generate` - regenerates DeepCopy methods
   - `make manifests` - regenerates CRD and RBAC from markers

3. Build the operator binary:
   - `make build` or `go build -o bin/manager cmd/main.go`

4. Verify CRD was generated:
   - Check k8s/dittofs-operator/config/crd/bases/dittofs.dittofs.com_dittoservers.yaml exists

5. If all succeeds, remove the old dittofs-operator/ directory:
   - `rm -rf dittofs-operator/`

Do NOT remove old directory if build fails - troubleshoot first.
  </action>
  <verify>
Run from k8s/dittofs-operator/:
- `make generate` completes without errors
- `make manifests` completes without errors
- `ls bin/manager` or `go build ./...` succeeds
- `ls config/crd/bases/` shows CRD yaml file
- `ls -la ../../dittofs-operator 2>/dev/null || echo "Old directory removed"` - should say "Old directory removed"
  </verify>
  <done>Operator builds successfully in k8s/dittofs-operator/, old directory removed</done>
</task>

</tasks>

<verification>
From repository root:
1. `ls k8s/dittofs-operator/` - directory exists with all subdirectories
2. `grep "module github.com/marmos91/dittofs/k8s/dittofs-operator" k8s/dittofs-operator/go.mod` - returns the line
3. `cd k8s/dittofs-operator && go build ./...` - builds without errors
4. `ls dittofs-operator 2>/dev/null || echo "OK"` - old directory is gone
</verification>

<success_criteria>
- Operator source code relocated to k8s/dittofs-operator/
- Go module path updated to github.com/marmos91/dittofs/k8s/dittofs-operator
- All imports updated to use new module path
- `make generate` and `make manifests` succeed
- `go build ./...` succeeds
- Old dittofs-operator/ directory removed
</success_criteria>

<output>
After completion, create `.planning/phases/01-operator-foundation/01-01-SUMMARY.md`
</output>
