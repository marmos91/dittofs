---
phase: 29-core-layer-decomposition
task: wave-3
total_tasks: 4-waves
status: in_progress
last_updated: 2026-02-26T11:57:35.156Z
---

<current_state>
Phase 29 execution is midway. Waves 1 and 2 are complete with PRs opened. Waves 3 and 4 remain.

Current branch: `phase-29-wave-2` (Wave 2 just completed).
Wave 3 needs a new branch `phase-29-wave-3` based on `phase-29-wave-2`.
</current_state>

<completed_work>

- Wave 1 (Plans 29-01, 29-02, 29-03) - DONE, PR #204 opened
  - 29-01: PayloadError + ProtocolError types, generic GORM helpers, generic API client helpers
  - 29-02: TransferManager renamed to Offloader, pkg/payload/transfer/ moved to pkg/payload/offloader/, manager.go split into focused files, GC extracted to pkg/payload/gc/
  - 29-03: file.go (1217 lines) split into file_create.go, file_modify.go, file_remove.go, file_helpers.go, file_types.go; authentication.go (796 lines) split into auth_identity.go, auth_permissions.go
  - 3x code-simplifier ran, PR prepared via pr-preparer
  - Branch: `phase-29-wave-1` targeting `phase-29-core-layer-decomposition`

- Wave 2 (Plans 29-04, 29-05) - DONE, PR #205 opened
  - 29-04: Store interface decomposed into ~12 sub-interfaces (UserStore, GroupStore, ShareStore, etc.), all API handlers narrowed to accept narrowest sub-interface, underscore files renamed
  - 29-05: PayloadService I/O extracted to pkg/payload/io/ sub-package, metadata store conformance test suite created in pkg/metadata/storetest/ (16 tests, memory store passes all)
  - 1x code-simplifier ran (context got large, skipped remaining passes)
  - Branch: `phase-29-wave-2` targeting `phase-29-wave-1`

</completed_work>

<remaining_work>

- Wave 3 (Plan 29-06) - NOT STARTED
  - Runtime decomposition into 6 sub-services (AdapterManager, MetadataStoreManager, etc.)
  - Plan file: .planning/phases/29-core-layer-decomposition/29-06-PLAN.md
  - Create branch `phase-29-wave-3` from `phase-29-wave-2`
  - After execution: 3x code-simplifier, then pr-preparer targeting `phase-29-wave-2`

- Wave 4 (Plan 29-07) - NOT STARTED
  - Auth centralization, API error mapping, documentation update
  - Plan file: .planning/phases/29-core-layer-decomposition/29-07-PLAN.md
  - Create branch `phase-29-wave-4` from `phase-29-wave-3`
  - After execution: 3x code-simplifier, then pr-preparer targeting `phase-29-wave-3`

</remaining_work>

<decisions_made>

- PR workflow: After each wave, run code-simplifier 3x, then pr-preparer
- Branch chaining: Each wave branch is based on previous wave's branch
- PR targeting: Each PR targets the previous wave's branch (wave-2 -> wave-1 -> phase-29-core-layer-decomposition)
- Don't wait for CI on PRs — continue implementation immediately
- Plan 29-03 deviated: Used flat file split (same package) instead of sub-packages due to Go circular import prohibition. Organizational goal fully achieved.
- All commits must be GPG signed (-S flag)
- No Claude Code mentions in commits or PRs

</decisions_made>

<blockers>
- None. All work is unblocked. Just ran out of context window.
</blockers>

<context>
The overall pattern for each remaining wave is:
1. Create new branch from previous wave: `git checkout -b phase-29-wave-{N}`
2. Spawn gsd-executor with the plan file
3. Verify build/tests pass
4. Run code-simplifier:code-simplifier 3 times
5. Launch pr-preparer targeting previous wave's branch
6. Move to next wave

Diagnostics from the IDE are consistently stale — always verify with `go build ./...` before acting on them.
</context>

<next_action>
1. `git checkout -b phase-29-wave-3` (from current phase-29-wave-2)
2. Read `.planning/phases/29-core-layer-decomposition/29-06-PLAN.md`
3. Spawn gsd-executor to execute Plan 29-06 (Runtime decomposition)
4. After completion: 3x code-simplifier:code-simplifier, then pr-preparer targeting phase-29-wave-2
5. Then repeat for Wave 4 (Plan 29-07)
</next_action>
