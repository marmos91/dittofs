---
phase: 27-nfs-adapter-restructuring
plan: 04
type: execute
wave: 3
depends_on:
  - 27-02
  - 27-03
files_modified:
  - internal/adapter/nfs/v3/handlers/*.go (documentation added)
  - internal/adapter/nfs/v4/handlers/*.go (documentation added)
  - internal/adapter/nfs/v4/v41/handlers/*.go (documentation added)
  - internal/adapter/nfs/mount/handlers/*.go (documentation added)
  - internal/adapter/nfs/nlm/handlers/*.go (documentation added)
  - internal/adapter/nfs/nsm/handlers/*.go (documentation added)
autonomous: true
requirements:
  - REF-03

must_haves:
  truths:
    - "Every handler function across v3, v4, v4.1, mount, NLM, and NSM has a 5-line Godoc comment block"
    - "Handler docs follow the template: RFC reference, protocol semantics, delegation path, side effects, key error conditions"
    - "v4.1 handler docs explicitly mark NFSv4.1 minor version"
    - "Stub/unimplemented handlers have full docs plus a TODO line"
    - "`go build ./...` and `go test ./...` pass with zero failures"
  artifacts:
    - path: "internal/adapter/nfs/v3/handlers/"
      provides: "22 documented handler functions"
      contains: "RFC 1813"
    - path: "internal/adapter/nfs/v4/handlers/"
      provides: "~30 documented handler functions"
      contains: "RFC 7530"
    - path: "internal/adapter/nfs/v4/v41/handlers/"
      provides: "11 documented v4.1 handler functions"
      contains: "RFC 8881"
    - path: "internal/adapter/nfs/mount/handlers/"
      provides: "6 documented mount handler functions"
      contains: "RFC 1813"
    - path: "internal/adapter/nfs/nlm/handlers/"
      provides: "~8 documented NLM handler functions"
      contains: "RFC 1813"
  key_links:
    - from: "handler documentation"
      to: "RFC references"
      via: "Section numbers in Godoc comments"
      pattern: "RFC \\d{4}"
---

<objective>
Add 5-line Godoc documentation to every handler function across all NFS ecosystem protocols (v3, v4, v4.1, mount, NLM, NSM) totaling ~80+ handler functions.

Purpose: Improve codebase maintainability with concise handler documentation covering RFC references, semantics, delegation paths, side effects, and error conditions.
Output: All handler functions documented with consistent 5-line Godoc blocks.
</objective>

<execution_context>
@/Users/marmos91/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marmos91/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-nfs-adapter-restructuring/27-CONTEXT.md
@.planning/phases/27-nfs-adapter-restructuring/27-RESEARCH.md
@.planning/phases/27-nfs-adapter-restructuring/27-02-SUMMARY.md
@.planning/phases/27-nfs-adapter-restructuring/27-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add handler documentation to v3, mount, NLM, and NSM handlers</name>
  <files>
    internal/adapter/nfs/v3/handlers/*.go (~22 handlers)
    internal/adapter/nfs/mount/handlers/*.go (~6 handlers)
    internal/adapter/nfs/nlm/handlers/*.go (~8 handlers)
    internal/adapter/nfs/nsm/handlers/*.go (~6 handlers)
  </files>
  <action>
    Add 5-line Godoc comment blocks above each handler function. Follow the template from CONTEXT.md:

    ```go
    // HandleXxx handles NFS XXX (RFC NNNN Section X.Y.Z).
    // [Protocol semantics - what the operation does]
    // [Delegation path - what services/stores are called]
    // [Side effects - what state is modified]
    // [Key error conditions - NFS3ERR_XXX cases]
    ```

    **v3 handlers** (~22 in `v3/handlers/`): Reference RFC 1813.
    - access.go, commit.go, create.go, fsinfo.go, fsstat.go, getattr.go, link.go, lookup.go, mkdir.go, mknod.go, null.go, pathconf.go, read.go, readdir.go, readdirplus.go, readlink.go, remove.go, rename.go, rmdir.go, setattr.go, symlink.go, write.go
    - Also document any helper functions that serve as pseudo-handlers

    **mount handlers** (~6 in `mount/handlers/`): Reference RFC 1813 Appendix I.
    - MNT, UMNT, UMNTALL, EXPORT, DUMP, NULL

    **NLM handlers** (~8 in `nlm/handlers/`): Reference RFC 1813 (NLM portion).
    - LOCK, UNLOCK, TEST, CANCEL, GRANTED, SM_NOTIFY, NULL, plus any blocking lock handlers

    **NSM handlers** (~6 in `nsm/handlers/`): Reference NSM protocol.
    - STAT, MON, UNMON, UNMON_ALL, NOTIFY, NULL

    For each handler:
    1. Read the handler function to understand what it does
    2. Identify the RFC section (use section number, not URL per CONTEXT.md)
    3. Note the delegation path (MetadataService, BlockService, etc.)
    4. Note side effects (attribute updates, state changes)
    5. Note key error conditions
    6. Write 5-line Godoc comment above the function signature

    For stub/unimplemented handlers, add full docs plus a `// TODO:` line explaining what's missing.

    Keep docs concise and maintainable -- no over-documentation per CONTEXT.md.

    Verify: `go build ./...` (documentation-only changes should not break build)
  </action>
  <verify>
    <automated>cd /Users/marmos91/Projects/dittofs && go build ./... && go vet ./...</automated>
    <manual>Spot-check 5 handler files to verify each has a 5-line Godoc block with RFC reference</manual>
  </verify>
  <done>All v3, mount, NLM, and NSM handler functions have 5-line Godoc comment blocks with RFC references, semantics, delegation paths, side effects, and error conditions.</done>
</task>

<task type="auto">
  <name>Task 2: Add handler documentation to v4 and v4.1 handlers</name>
  <files>
    internal/adapter/nfs/v4/handlers/*.go (~30+ handlers)
    internal/adapter/nfs/v4/v41/handlers/*.go (11 handlers)
  </files>
  <action>
    Add 5-line Godoc comment blocks to all v4 and v4.1 handler functions.

    **v4.0 handlers** (~30+ in `v4/handlers/`): Reference RFC 7530.
    - access.go, close.go, commit.go, compound.go, create.go, delegreturn.go, getattr.go, getfh.go, illegal.go, link.go, lock.go, lookup.go, lookupp.go, null.go, nverify.go, open.go, putfh.go, putpubfh.go, putrootfh.go, read.go, readdir.go, readlink.go, remove.go, rename.go, renew.go, restorefh.go, savefh.go, secinfo.go, setattr.go, verify.go, write.go
    - Also document COMPOUND processing logic in compound.go

    **v4.1 handlers** (11 in `v4/v41/handlers/`): Reference RFC 8881.
    Per CONTEXT.md: "v4.1 handlers explicitly mark minor version: 'handles NFSv4.1 CREATE_SESSION'"
    - exchange_id.go, create_session.go, destroy_session.go, destroy_clientid.go, bind_conn_to_session.go, backchannel_ctl.go, sequence.go, reclaim_complete.go, free_stateid.go, get_dir_delegation.go, test_stateid.go

    For each handler:
    1. Read the function to understand the operation
    2. v4.0 -> RFC 7530; v4.1 -> RFC 8881
    3. Note the delegation path (StateManager, MetadataService, etc.)
    4. Note side effects (state creation/modification, cache updates)
    5. Note key error conditions (NFS4ERR_xxx)
    6. Write 5-line Godoc comment

    Example for v4.1 (from CONTEXT.md):
    ```go
    // handleCreateSession handles NFSv4.1 CREATE_SESSION (RFC 8881 Section 18.36).
    // Creates a new session for the client, establishing slot table and back-channel.
    // Delegates to StateManager for session creation and seqid validation.
    // Caches response bytes for replay detection. Auto-binds originating connection.
    // Errors: NFS4ERR_STALE_CLIENTID, NFS4ERR_SEQ_MISORDERED, NFS4ERR_RESOURCE.
    ```

    Verify: `go build ./...` and `go test ./...`
  </action>
  <verify>
    <automated>cd /Users/marmos91/Projects/dittofs && go build ./... && go test ./...</automated>
    <manual>Spot-check 5 v4/v4.1 handler files to verify Godoc blocks reference RFC 7530 or RFC 8881</manual>
  </verify>
  <done>All v4 and v4.1 handler functions have 5-line Godoc comment blocks. v4.1 handlers explicitly mark minor version. Stub handlers include TODO lines. Build and tests pass.</done>
</task>

</tasks>

<verification>
1. Every handler function in v3, v4, v4.1, mount, NLM, NSM has a Godoc comment block
2. Comments follow the 5-line template (RFC ref, semantics, delegation, side effects, errors)
3. v4.1 handlers mark minor version explicitly
4. Stub handlers have TODO lines
5. `go build ./...` passes
6. `go vet ./...` passes
7. `go test ./...` passes
</verification>

<success_criteria>
- ~80+ handler functions documented with consistent 5-line Godoc blocks
- All RFC references use section numbers (not URLs)
- v4.1 handlers clearly marked as NFSv4.1
- No build or test regressions
</success_criteria>

<output>
After completion, create `.planning/phases/27-nfs-adapter-restructuring/27-04-SUMMARY.md`
</output>
