---
milestone: v3.5
audited: "2026-02-26T14:30:00Z"
status: tech_debt
scores:
  requirements: 6/6
  phases: 4/4
  integration: 15/16
  flows: 7/7
gaps:
  requirements:
    - id: "REF-04"
      status: "partial"
      phase: "28"
      claimed_by_plans: ["28-01-PLAN.md", "28-02-PLAN.md", "28-03-PLAN.md", "28-04-PLAN.md", "28-05-PLAN.md"]
      completed_by_plans: ["28-01-SUMMARY.md", "28-02-SUMMARY.md", "28-03-SUMMARY.md", "28-04-SUMMARY.md", "28-05-SUMMARY.md"]
      verification_status: "missing"
      evidence: "All 5 SUMMARYs claim REF-04 complete, integration checker confirms wiring, but no VERIFICATION.md exists"
    - id: "REF-05"
      status: "partial"
      phase: "29"
      claimed_by_plans: ["29-02-PLAN.md", "29-04-PLAN.md", "29-06-PLAN.md"]
      completed_by_plans: ["29-02-SUMMARY.md", "29-04-SUMMARY.md", "29-06-SUMMARY.md"]
      verification_status: "missing"
      evidence: "All 8 sub-reqs claimed by SUMMARYs, integration checker confirms wiring, but no VERIFICATION.md exists"
    - id: "REF-06"
      status: "partial"
      phase: "29"
      claimed_by_plans: ["29-01-PLAN.md", "29-03-PLAN.md", "29-05-PLAN.md", "29-07-PLAN.md"]
      completed_by_plans: ["29-01-SUMMARY.md", "29-03-SUMMARY.md", "29-05-SUMMARY.md", "29-07-SUMMARY.md"]
      verification_status: "missing"
      evidence: "All 9 sub-reqs claimed by SUMMARYs, integration checker confirms wiring, but no VERIFICATION.md exists"
  integration:
    - "Cross-protocol oplock break callbacks deferred (4 TODO(plan-03) markers in v3 handlers)"
  flows: []
tech_debt:
  - phase: "28-smb-adapter-restructuring"
    items:
      - "Missing VERIFICATION.md — phase was never formally verified"
  - phase: "29-core-layer-decomposition"
    items:
      - "Missing VERIFICATION.md — phase was never formally verified"
  - phase: "26-generic-lock-interface-protocol-leak-purge"
    items:
      - "REF-01.8 (SMB thin translation layer) and REF-01.9 (NFSv4 thin translation layer) marked partial"
      - "4 TODO(plan-03) markers in NFS v3 handlers for cross-protocol oplock break wiring"
  - phase: "requirements-tracking"
    items:
      - "REQUIREMENTS.md traceability table outdated — checkboxes not updated for completed requirements"
---

# v3.5 Milestone Audit: Adapter + Core Refactoring

**Audited:** 2026-02-26T14:30:00Z
**Status:** TECH DEBT (no blockers, accumulated debt needs review)
**Phases:** 26, 27, 28, 29 (4 phases, 21 plans)

## Executive Summary

All 6 requirements (REF-01 through REF-06) are functionally complete based on SUMMARY claims and integration verification. Build passes, all tests pass, 15/16 integration points wired. However, Phases 28 and 29 lack formal VERIFICATION.md files, and the REQUIREMENTS.md traceability table is outdated.

## Phase Verification Status

| Phase | Name | Plans | VERIFICATION.md | Status |
|-------|------|-------|-----------------|--------|
| 26 | Generic Lock Interface & Protocol Leak Purge | 5/5 | Present | PASSED (10/10) |
| 27 | NFS Adapter Restructuring | 4/4 | Present | PASSED (9/9, REF-03.4 deferred to Ph28) |
| 28 | SMB Adapter Restructuring | 5/5 | **MISSING** | Unverified (5 SUMMARYs claim complete) |
| 29 | Core Layer Decomposition | 7/7 | **MISSING** | Unverified (7 SUMMARYs claim complete) |

## Requirements Coverage (3-Source Cross-Reference)

### REF-01: Generic Lock Interface (Phase 26) — SATISFIED

| Sub-Req | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|---------|-------------|---------|-----------------|-------|
| REF-01.1-7 | passed | 26-01 | `[ ]` | satisfied (update checkbox) |
| REF-01.8 | partial | 26-01 | `[ ]` | partial (adapter translation) |
| REF-01.9 | partial | 26-01 | `[ ]` | partial (adapter translation) |
| REF-01.10 | passed | 26-01 | `[ ]` | satisfied (update checkbox) |

**Score:** 8/10 satisfied, 2 partial (adapter translations — out of Phase 26 scope)

### REF-02: Protocol Leak Purge (Phase 26) — SATISFIED

All 11 sub-requirements passed in VERIFICATION.md and claimed by SUMMARYs.

**Score:** 11/11 satisfied

### REF-03: NFS Adapter Restructuring (Phase 27) — SATISFIED

10/11 passed in Phase 27 VERIFICATION.md. REF-03.4 (`internal/auth/` move) deferred to Phase 28 and completed there (28-01-SUMMARY confirms the move).

**Score:** 11/11 satisfied

### REF-04: SMB Adapter Restructuring (Phase 28) — PARTIAL (verification gap)

No VERIFICATION.md exists. All 11 sub-requirements claimed by SUMMARYs 28-01 through 28-05. Integration checker confirms BaseAdapter wiring, auth consolidation, and dispatch restructuring.

**Score:** 0/11 formally verified, 11/11 claimed + integration-confirmed

### REF-05: Core Object Decomposition (Phase 29) — PARTIAL (verification gap)

No VERIFICATION.md exists. All 8 sub-requirements claimed by SUMMARYs:
- REF-05.1-2: Store sub-interfaces (29-04)
- REF-05.3-4: Runtime sub-services (29-06)
- REF-05.5-8: Offloader decomposition (29-02)

Integration checker confirms all wiring.

**Score:** 0/8 formally verified, 8/8 claimed + integration-confirmed

### REF-06: Code Quality Improvements (Phase 29) — PARTIAL (verification gap)

No VERIFICATION.md exists. All 9 sub-requirements claimed by SUMMARYs:
- REF-06.1-3,5: Error types + generic helpers (29-01)
- REF-06.4: API error mapping (29-07)
- REF-06.6-7: Storetest + transaction helpers (29-05)
- REF-06.8-9: File splits (29-03)

Integration checker confirms all wiring.

**Score:** 0/9 formally verified, 9/9 claimed + integration-confirmed

## Integration Check Results

**Checker:** gsd-integration-checker (sonnet)

### Wiring Summary

| # | Integration Point | Status | Requirements |
|---|-------------------|--------|--------------|
| 1 | Phase 26 lock types → Phase 27/28 adapter handlers | WIRED | REF-01 |
| 2 | Phase 28 BaseAdapter → NFS + SMB adapters | WIRED | REF-04 |
| 3 | Phase 29 store sub-interfaces → API handlers + runtime | WIRED | REF-05 |
| 4 | Phase 29 auth centralization → Kerberos + adapters | WIRED | REF-06 |
| 5 | Phase 29 runtime sub-services → composition layer | WIRED | REF-05 |
| 6 | Phase 26 NLMService → NLM handlers | WIRED | REF-02 |
| 7 | Phase 27 consolidated dispatch → connection handlers | WIRED | REF-03 |
| 8 | Phase 27 v4.1 handler extraction → v4 dispatch table | WIRED | REF-03 |
| 9 | Phase 29 payload offloader → PayloadService | WIRED | REF-05 |
| 10 | Phase 29 metadata file splits → MetadataService | WIRED | REF-05 |
| 11 | Phase 29 API error mapping → handlers | WIRED | REF-06 |
| 12 | Phase 26 ShareAdapterConfig → runtime + API | WIRED | REF-02 |
| 13 | Phase 26 MountTracker → runtime + adapters | WIRED | REF-02 |
| 14 | Phase 27 directory restructuring → all imports | WIRED | REF-03 |
| 15 | Phase 29 metadata storetest → store implementations | WIRED | REF-05 |
| 16 | Cross-protocol oplock break callbacks | **PARTIAL** | REF-02 |

**Score:** 15/16 fully wired, 1 intentionally deferred

### E2E Flows

| Flow | Status |
|------|--------|
| Server start → adapter creation → mount → file ops → unmount | Complete |
| Store creation → share creation → adapter config → NFS export | Complete |
| User auth → JWT → API handler → store sub-interface → GORM | Complete |
| Payload write → cache → offloader → block store | Complete |
| Metadata ops → MetadataService → file_create/modify/remove | Complete |
| Runtime init → sub-service composition → lifecycle serve | Complete |
| Auth chain → AuthProvider → Kerberos → Identity | Complete |

**Score:** 7/7 flows complete

### Build & Test

- `go build ./...` — PASS
- `go test ./...` — PASS (41 packages)
- Zero stale references to old types or paths

## Tech Debt

| Phase | Item | Severity |
|-------|------|----------|
| 28 | Missing VERIFICATION.md | Low |
| 29 | Missing VERIFICATION.md | Low |
| 26 | REF-01.8/REF-01.9 adapter translations partial | Low |
| 26 | 4 TODO(plan-03) cross-protocol oplock break markers | Medium |
| All | REQUIREMENTS.md traceability table outdated | Low |

**Total:** 5 items across 4 categories

## Assessment

The v3.5 milestone is **functionally complete**:
- All 21 plans across 4 phases executed successfully
- All 6 requirement groups have full SUMMARY coverage
- Integration checker confirms 15/16 cross-phase connections
- Build and all tests pass

Outstanding debt is **procedural, not functional**:
- 2 missing VERIFICATION.md files (Phase 28, Phase 29)
- Outdated REQUIREMENTS.md checkboxes
- 1 intentionally deferred integration point (cross-protocol oplock breaks)

---
*Audited: 2026-02-26T14:30:00Z*
*Auditor: Claude (gsd-audit-milestone)*
