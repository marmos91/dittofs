---
milestone: v3.5
audited: "2026-02-26T18:00:00Z"
status: tech_debt
scores:
  requirements: 6/6
  phases: 5/5
  integration: 15/16
  flows: 7/7
gaps:
  requirements: []
  integration:
    - "Cross-protocol oplock break callbacks deferred (4 TODO(plan-03) markers in v3 handlers)"
  flows: []
tech_debt:
  - phase: "26-generic-lock-interface-protocol-leak-purge"
    items:
      - "REF-01.8 (SMB thin translation layer) and REF-01.9 (NFSv4 thin translation layer) partial — deferred to v3.8"
      - "4 TODO(plan-03) markers in NFS v3 handlers for cross-protocol oplock break wiring"
  - phase: "29-core-layer-decomposition"
    items:
      - "PayloadError type defined (pkg/payload/errors.go) but not yet wired into production error paths"
---

# v3.5 Milestone Audit: Adapter + Core Refactoring

**Audited:** 2026-02-26T18:00:00Z
**Status:** TECH DEBT (no blockers, minor accumulated debt)
**Phases:** 26, 27, 28, 29, 29.4 (5 phases, 22 plans)

## Executive Summary

All 6 requirements (REF-01 through REF-06) are complete with formal verification. Build passes, all tests pass, 15/16 integration points wired. Phase 29.4 closed the verification and traceability gaps identified in the previous audit.

## Phase Verification Status

| Phase | Name | Plans | VERIFICATION.md | Status |
|-------|------|-------|-----------------|--------|
| 26 | Generic Lock Interface & Protocol Leak Purge | 5/5 | Present | PASSED (10/10) |
| 27 | NFS Adapter Restructuring | 4/4 | Present | PASSED (9/9, REF-03.4 completed in Ph28) |
| 28 | SMB Adapter Restructuring | 5/5 | Present | PASSED (11/11) |
| 29 | Core Layer Decomposition | 7/7 | Present | PASSED (10/10: REF-05 8/8, REF-06 9/9) |
| 29.4 | Verification Artifacts & Requirements Cleanup | 1/1 | Present | PASSED (4/4) |

## Requirements Coverage (3-Source Cross-Reference)

### REF-01: Generic Lock Interface (Phase 26) — SATISFIED

| Sub-Req | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|---------|-------------|---------|-----------------|-------|
| REF-01.1-7 | passed | 26-01 | `[x]` | satisfied |
| REF-01.8 | partial | 26-01 | `[ ]` | partial (adapter translation deferred to v3.8) |
| REF-01.9 | partial | 26-01 | `[ ]` | partial (adapter translation deferred to v3.8) |
| REF-01.10 | passed | 26-01 | `[x]` | satisfied |

**Score:** 8/10 satisfied, 2 partial (adapter translations — intentionally deferred to v3.8)

### REF-02: Protocol Leak Purge (Phase 26) — SATISFIED

All 11 sub-requirements passed in VERIFICATION.md, claimed by SUMMARYs 26-02/04/05, all `[x]` in REQUIREMENTS.md.

**Score:** 11/11 satisfied

### REF-03: NFS Adapter Restructuring (Phase 27) — SATISFIED

10/11 passed in Phase 27 VERIFICATION.md. REF-03.4 (`internal/auth/` move) deferred to Phase 28 and completed there (28-01-SUMMARY confirms). All `[x]` in REQUIREMENTS.md.

**Score:** 11/11 satisfied

### REF-04: SMB Adapter Restructuring (Phase 28) — SATISFIED

All 11 sub-requirements verified in 28-VERIFICATION.md (created by Phase 29.4), claimed by SUMMARYs 28-01 through 28-05, all `[x]` in REQUIREMENTS.md.

**Score:** 11/11 satisfied

### REF-05: Core Object Decomposition (Phase 29) — SATISFIED

All 8 sub-requirements verified in 29-VERIFICATION.md (created by Phase 29.4), claimed by SUMMARYs 29-02/04/06, all `[x]` in REQUIREMENTS.md.

**Score:** 8/8 satisfied

### REF-06: Code Quality Improvements (Phase 29) — SATISFIED

All 9 sub-requirements verified in 29-VERIFICATION.md (created by Phase 29.4), claimed by SUMMARYs 29-01/03/05/07, all `[x]` in REQUIREMENTS.md.

**Score:** 9/9 satisfied

### Orphan Detection

No orphaned requirements. All 6 REQ-IDs present in VERIFICATION.md files, SUMMARY frontmatter, and REQUIREMENTS.md traceability table.

## Integration Check Results

**Checker:** gsd-integration-checker (sonnet)

### Wiring Summary

| # | Integration Point | Status | Requirements |
|---|-------------------|--------|--------------|
| 1 | Phase 26 lock types → Phase 27/28 adapter handlers | WIRED | REF-01 |
| 2 | Phase 28 BaseAdapter → NFS + SMB adapters | WIRED | REF-04 |
| 3 | Phase 29 store sub-interfaces → API handlers + runtime | WIRED | REF-05 |
| 4 | Phase 29 auth centralization → Kerberos + adapters | WIRED | REF-06 |
| 5 | Phase 29 runtime sub-services → composition layer | WIRED | REF-05 |
| 6 | Phase 26 NLMService → NLM handlers | WIRED | REF-02 |
| 7 | Phase 27 consolidated dispatch → connection handlers | WIRED | REF-03 |
| 8 | Phase 27 v4.1 handler extraction → v4 dispatch table | WIRED | REF-03 |
| 9 | Phase 29 payload offloader → PayloadService | WIRED | REF-05 |
| 10 | Phase 29 metadata file splits → MetadataService | WIRED | REF-05 |
| 11 | Phase 29 API error mapping → handlers | WIRED | REF-06 |
| 12 | Phase 26 ShareAdapterConfig → runtime + API | WIRED | REF-02 |
| 13 | Phase 26 MountTracker → runtime + adapters | WIRED | REF-02 |
| 14 | Phase 27 directory restructuring → all imports | WIRED | REF-03 |
| 15 | Phase 29 metadata storetest → store implementations | WIRED | REF-05 |
| 16 | Cross-protocol oplock break callbacks | **PARTIAL** | REF-01 |

**Score:** 15/16 fully wired, 1 intentionally deferred

### E2E Flows

| Flow | Status |
|------|--------|
| Server start → adapter creation → mount → file ops → unmount | Complete |
| Store creation → share creation → adapter config → NFS export | Complete |
| User auth → JWT → API handler → store sub-interface → GORM | Complete |
| Payload write → cache → offloader → block store | Complete |
| Metadata ops → MetadataService → file_create/modify/remove | Complete |
| Runtime init → sub-service composition → lifecycle serve | Complete |
| Auth chain → AuthProvider → Kerberos → Identity | Complete |

**Score:** 7/7 flows complete

### Build & Test

- `go build ./...` — PASS
- `go test ./pkg/adapter/... ./pkg/controlplane/... ./pkg/metadata/... ./pkg/payload/...` — PASS
- Zero stale references to old types or paths

## Tech Debt

| Phase | Item | Severity |
|-------|------|----------|
| 26 | REF-01.8/REF-01.9 adapter translations partial (deferred to v3.8) | Low |
| 26 | 4 TODO(plan-03) cross-protocol oplock break markers in NFS v3 handlers | Medium |
| 29 | PayloadError type defined but not yet wired into production error paths | Low |

**Total:** 3 items across 2 phases

## Assessment

The v3.5 milestone is **complete**:
- All 22 plans across 5 phases executed successfully
- All 6 requirement groups formally verified with codebase evidence
- REQUIREMENTS.md traceability table clean (no pending verification notes)
- Integration checker confirms 15/16 cross-phase connections
- Build and all tests pass
- 7/7 E2E flows verified end-to-end

Outstanding debt is **minor and intentional**:
- 2 adapter translation sub-requirements deferred to v3.8 (when SMB3 protocol upgrade adds the translation layer)
- 4 TODO markers for cross-protocol oplock breaks (requires v3.8 SMB3 integration)
- PayloadError infrastructure ready but not yet consumed (will be wired when error paths are updated)

---
*Audited: 2026-02-26T18:00:00Z*
*Previous audit: 2026-02-26T14:30:00Z (gaps_found → resolved by Phase 29.4)*
