apiVersion: dittofs.dittofs.com/v1alpha1
kind: DittoServer
metadata:
  labels:
    app.kubernetes.io/name: dittofs-operator
    app.kubernetes.io/managed-by: kustomize
  name: dittoserver-with-cache
spec:
  image: marmos91c/dittofs:latest
  replicas: 1
  
  # Storage for server's internal volumes
  storage:
    metadataSize: "10Gi"
    contentSize: "50Gi"
  
  # DittoFS configuration
  config:
    # Define storage backends
    backends:
      - name: badger-metadata
        type: badger
        config:
          path: /data/metadata
      
      - name: s3-content
        type: s3
        config:
          bucket: my-ditto-bucket
          region: us-east-1
    
    # Define cache for performance optimization
    caches:
      - name: main-cache
        type: memory
        memory:
          maxSize: "1Gi"  # Maximum cache size
        prefetch:
          enabled: true
          maxFileSize: "100Mi"  # Don't prefetch files larger than this
          chunkSize: "512Ki"    # Prefetch chunk size
        flusher:
          interval: "10s"       # How often to check for idle files
          flushTimeout: "30s"   # How long a file must be idle before flushing
          workers: 4            # Number of parallel flush workers
    
    # Define NFS shares
    shares:
      - name: default-share
        exportPath: /export
        metadataStore: badger-metadata
        contentStore: s3-content
        cache: main-cache  # Reference the cache
  
  # Service configuration
  service:
    type: ClusterIP
