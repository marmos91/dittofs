# Example DittoServer configuration for AWS S3 storage
#
# This example uses AWS S3 in eu-north-1 region
# Apply with: kubectl apply -f config/samples/ditto.io_v1alpha1_dittoserver_aws_s3.yaml
#
apiVersion: dittofs.dittofs.com/v1alpha1
kind: DittoServer
metadata:
  labels:
    app.kubernetes.io/name: dittofs-operator
    app.kubernetes.io/managed-by: kustomize
  name: dittoserver-aws-s3
spec:
  image: marmos91c/dittofs:latest
  replicas: 1
  
  storage:
    metadataSize: "10Gi"
    contentSize: "10Gi"
  
  config:
    backends:
      - name: badger-metadata
        type: badger
        config:
          path: /data/metadata
      
      - name: s3-content
        type: s3
        config:
          bucket: dittofs-bucket
          
          region: us-east-1
          
          access_key_id: <AWS_ACCESS_KEY>
          secret_access_key: <AWS_SECRET_ACCESS_KEY>
    
    caches:
      - name: s3-cache
        type: memory
        memory:
          maxSize: "2Gi"
        prefetch:
          enabled: true
          maxFileSize: "100Mi"
          chunkSize: "512Ki"
        flusher:
          interval: "10s"
          flushTimeout: "30s"
          workers: 4
    
    shares:
      - name: s3-share
        exportPath: /s3
        metadataStore: badger-metadata
        contentStore: s3-content
        cache: s3-cache
  
  nfsPort: 12049
  
  service:
    type: ClusterIP
  
  resources:
    limits:
      cpu: "2"
      memory: "4Gi"
    requests:
      cpu: "500m"
      memory: "1Gi"
